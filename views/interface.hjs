<!doctype html>
<html lang="en">
    <head>
        <title>{{ title }}</title>
    </head>
    <body>
        <h1>Rehabilitate</h1>
		<a href="/">Back</a>
        
		<!-- error message-->
		{{#message}}
      		<p>{{message}}<p>
    	{{/message}}
		
		<div id="start">
            Start
        </div>
        <div id="stop">
            Stop
        </div>
		<div>
			<p class="sets"></p>
			<br>
			<p class= "reps"></p>
		</div>
		<form action='/twilio' method='post'>
			<input type='submit' value="Text!">
		</form>
  
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="js/myo.js"></script>
        <script>
           $(document).ready(function() {
				var myMyo = Myo.create();
				myMyo.unlock();
				var bool = true;
				var record = false;
				var final = [];
				var accFinal = [];



			   	$( ".sets").text( {{ sets }} );

				var count = 0;
				var count_sets = {{sets}} ;
				var count_reps = {{ reps }} ;

			   	$( ".sets").text("Sets left: " + count_sets);
			   	$( ".reps").text("Reps left: " + count_reps);

				$( "#start" ).click(function() {
					record = true;
				});
			   

				$( "#stop" ).click(function() {
					record = false;
					alert("stop");
					//var res = $.csv.fromArrays(final);
					//console.log(res);
					var resAcc = $.csv.fromArrays(accFinal);
					console.log("ACCELERATION");
					console.log(resAcc);
				});	

				

				myMyo.on('pose', function(pose_name, edge) {
            	  if (pose_name != 'rest' && edge) {
          	      console.log('Started ', pose_name);
          	    	}

          	 	   if (pose_name == 'wave_in' && edge) {
           	  	   	console.log('good job (wave in)! ');

           	  	   if (count == 0) {
           	  	   	count = 1;
           	  	   }

           	  	   if (count == 2) {
           	  	   		count = 0;
           	  	   		count_reps = count_reps - 1;
           	  	   		$( ".reps").text("Reps left: " + count_reps);
           	  		}

            	  }
            		if (pose_name == 'wave_out' && edge) {
             	   		console.log('good job (wave out)!');
             	   		if (count == 0) {
           	  	   			count = 2;
           	  	   		}

           	  	  	 	if (count == 1) {
           	  	  		 count = 0;
           	  	   			count_reps = count_reps - 1;
           	  	   			$( ".reps").text("Reps left: " + count_reps);
           	  			}
             		 }

                    if (count_reps == 0 && count_sets != 0) {
                      count_sets = count_sets - 1;
                      $( ".sets").text("Sets left: " + count_sets);

                      if (count_sets != 0) {
                      	count_reps = {{ reps }};
                      	$( ".reps").text("Reps left: " + count_reps);
	                      $( ".reps").text("Congrats, you have finished a set! Please wait 3 minutes before begining the next set.");
	                      var time = 3000;
	                      setTimeout(function(){ $( ".reps").text("Countdown: 3");}, time);
	                      setTimeout(function(){ $( ".reps").text("Countdown: 2");}, time + 1000);
	                      setTimeout(function(){ $( ".reps").text("Countdown: 1");}, time + 2000);
	                      setTimeout(function(){ $( ".reps").text("Ready, Go!");}, time + 3000);
	                      setTimeout(function(){ $( ".reps").text(count_reps);}, time + 4000);
                  	}

                    }

                    if (count_sets == 0) {
                      alert ("ANNDD YOUU AREEE THE CHAMMPIOOONN");
                    }
           		 });
				/*
				myMyo.on('accelerometer', function(data){
					//console.log("acc");
					  if (record) {
						  var ax = data.x;
						  var ay = data.y;
						  var az = data.z;

						  // calculate data
						  var acc = [ax, ay, az];
						  accFinal.push(acc);
						  //console.log(result);
					  }
				});*/

            });
        </script>
    </body>
</html>
