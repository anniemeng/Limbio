<!doctype html>
<html lang="en">
    <head>
        <title>{{ title }}</title>
		<link rel="stylesheet" href="css/normalize.css"/>
		<link rel="stylesheet" href="css/main.css"/>
    </head>
    <body>
        <h1>Rehabilitate</h1>
        <p class="slogan">Treat yourself right</p>
		<!-- error message-->
		{{#message}}
      		<p>{{message}}<p>
    	{{/message}}
		
		<div id="testing">
			<div id="start">
				Start
			</div>
			<div id="stop">
				Stop
			</div>
		</div>
		<div>
			<p class="sets"></p>
			<p class= "reps"></p>
		</div>
		<form action='/twilio' method='post'>
			<input type='submit' value="Text!">
		</form>
  
         <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="js/myo.js"></script>
        <script>
           $(document).ready(function() {
				var myMyo = Myo.create();
				myMyo.unlock();
				var bool = true;
				var record = false;
				var final = [];
				var accFinal = [];



			   	$( ".sets").text( {{ sets }} );

				var count = 0;
				var count_sets = {{sets}} ;
				var count_reps = {{ reps }} ;

			   	$( ".sets").text(count_sets);
			   	$( ".reps").text(count_reps);

				$( "#start" ).click(function() {
					record = true;
					// alert("start");
					
				});
			   

				$( "#stop" ).click(function() {
					record = false;
					alert("stop");
					//var res = $.csv.fromArrays(final);
					//console.log(res);
					var resAcc = $.csv.fromArrays(accFinal);
					console.log("ACCELERATION");
					console.log(resAcc);
				});	

				

				myMyo.on('pose', function(pose_name, edge) {
            	  if (pose_name != 'rest' && edge) {
          	      console.log('Started ', pose_name);
          	    	}

          	 	   if (pose_name == 'wave_in' && edge) {
           	  	   	console.log('good job (wave in)! ');

           	  	   if (count == 0) {
           	  	   	count = 1;
           	  	   }

           	  	   if (count == 2) {
           	  	   		count = 0;
           	  	   		count_reps = count_reps - 1;
           	  	   		$( ".reps").text(count_reps);
           	  		}

            	  }
            		if (pose_name == 'wave_out' && edge) {
             	   		console.log('good job (wave out)!');
             	   		if (count == 0) {
           	  	   			count = 2;
           	  	   		}

           	  	  	 	if (count == 1) {
           	  	  		 count = 0;
           	  	   			count_reps = count_reps - 1;
           	  	   			$( ".reps").text(count_reps);
           	  			}
             		 }

                 if (count_reps == 0) {
                      count_reps = {{reps}};
                      $( ".reps").text(count_reps);
                      count_sets = count_sets - 1;
                      $( ".sets").text(count_sets);
                      var restWindow = window.open("", "Instructions", "width=300, height=200");
                      restWindow.document.write("<p> Please wait three minutes before continuing onto the next set. </p>");
                       setTimeout(function(){ restWindow.close()}, 180000);
                    }

                    if (count_sets == 0) {
                      alert ("ANNDD YOUU AREEE THE CHAMMPIOOONN");
                    }
           		 });
				/*
				myMyo.on('accelerometer', function(data){
					//console.log("acc");
					  if (record) {
						  var ax = data.x;
						  var ay = data.y;
						  var az = data.z;

						  // calculate data
						  var acc = [ax, ay, az];
						  accFinal.push(acc);
						  //console.log(result);
					  }
				});*/

		    

            });
        </script>
    </body>
</html>
